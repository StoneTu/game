window.__require=function t(o,e,n){function i(s,l){if(!e[s]){if(!o[s]){var r=s.split("/");if(r=r[r.length-1],!o[r]){var h="function"==typeof __require&&__require;if(!l&&h)return h(r,!0);if(c)return c(r,!0);throw new Error("Cannot find module '"+s+"'")}}var a=e[s]={exports:{}};o[s][0].call(a.exports,function(t){return i(o[s][1][t]||t)},a,a.exports,t,o,e,n)}return e[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({"atest-settings":[function(t,o,e){"use strict";cc._RF.push(o,"f0eb6lkYctHsK5+G/nxc3Ty","atest-settings"),console.log("Just test"),cc._RF.pop()},{}],"cases-settings":[function(t,o,e){"use strict";cc._RF.push(o,"a6265miA4BICbspTJSVhTyQ","cases-settings"),cc._RF.pop()},{}],char01:[function(t,o,e){"use strict";cc._RF.push(o,"dc643FtvEJOk7wRQD7v4bDA","char01");cc.Class({extends:cc.Component,properties:{body:{default:null,type:cc.Node},Uleg1:{default:null,type:cc.Node},Uleg2:{default:null,type:cc.Node},Lleg1:{default:null,type:cc.Node},Lleg2:{default:null,type:cc.Node},Uarm:{default:null,type:cc.Node}},walkMotion:function(t){this.timer+=t;var o=function(t,o){return t-o*Math.floor(t/o)}(this.timer,2*this.walkSpeed);o<this.walkSpeed&&1!=this.walkStep?(this.walkStep=1,console.log("this.walkStep",this.walkStep),this.bodyJointUleg1.upperAngle=40,this.bodyJointUleg1.maxMotorTorque=500,this.bodyJointUleg1.motorSpeed=50,this.bodyJointUleg1.enableMotor=!0,this.bodyJointUleg2.lowerAngle=-30,this.bodyJointUleg2.maxMotorTorque=-500,this.bodyJointUleg2.motorSpeed=-50,this.bodyJointUleg2.enableMotor=!0,this.Uleg2JointLleg2.lowerAngle=-30,this.Uleg1JointLleg1.lowerAngle=-90):o>this.walkSpeed&&2!=this.walkStep&&(this.walkStep=2,console.log("this.walkStep",this.walkStep),this.bodyJointUleg2.upperAngle=40,this.bodyJointUleg2.maxMotorTorque=500,this.bodyJointUleg2.motorSpeed=50,this.bodyJointUleg2.enableMotor=!0,this.bodyJointUleg1.lowerAngle=-30,this.bodyJointUleg1.maxMotorTorque=-500,this.bodyJointUleg1.motorSpeed=-50,this.bodyJointUleg1.enableMotor=!0,this.Uleg1JointLleg1.lowerAngle=-30,this.Uleg2JointLleg2.lowerAngle=-90)},walkSetting:function(){this.bodyJointUleg1.lowerAngle=-40,this.bodyJointUleg1.upperAngle=40,this.bodyJointUleg2.lowerAngle=-40,this.bodyJointUleg2.upperAngle=40,this.Uleg1JointLleg1.lowerAngle=-90,this.Uleg1JointLleg1.upperAngle=0,this.Uleg2JointLleg2.lowerAngle=-90,this.Uleg2JointLleg2.upperAngle=0},standMotion:function(){this.bodyJointUleg1.lowerAngle=0,this.bodyJointUleg1.upperAngle=0,this.bodyJointUleg2.lowerAngle=0,this.bodyJointUleg2.upperAngle=0,this.Uleg1JointLleg1.lowerAngle=0,this.Uleg1JointLleg1.upperAngle=0,this.Uleg2JointLleg2.lowerAngle=0,this.Uleg2JointLleg2.upperAngle=0},onLoad:function(){this.timer=0,this.walkMotionFlag=!1,this.walkStep=0,this.walkSpeed=2;this.body.getComponent(cc.RigidBody);for(var t=this.Uleg1.getComponent(cc.RigidBody),o=this.Uleg2.getComponent(cc.RigidBody),e=(this.Lleg1.getComponent(cc.RigidBody),this.Lleg2.getComponent(cc.RigidBody),this.Uarm.getComponent(cc.RigidBody)),n=this.body.getComponents(cc.RevoluteJoint),i=0;i<n.length;i++){var c=n[i].connectedBody;c===t?(this.bodyJointUleg1=n[i],this.bodyJointUleg1||console.log("err3")):c===o?(this.bodyJointUleg2=n[i],this.bodyJointUleg2||console.log("err4")):c===e&&(this.bodyJointUarm=n[i])}this.Uleg1JointLleg1=this.Uleg1.getComponents(cc.RevoluteJoint),this.Uleg1JointLleg1||console.log("err1"),this.Uleg2JointLleg2=this.Uleg2.getComponents(cc.RevoluteJoint),this.Uleg2JointLleg2||console.log("err2"),this.Lleg1Jointfoot1=this.Lleg1.getComponents(cc.RevoluteJoint),this.Lleg2Jointfoot2=this.Lleg2.getComponents(cc.RevoluteJoint)},start:function(){},update:function(t){this.bodyJointUleg1.lowerAngle&&(this.walkSetting(),this.walkMotion(t))}}),cc._RF.pop()},{}],char02:[function(t,o,e){"use strict";cc._RF.push(o,"0721376g7FJVK/YvF+ksHUS","char02");cc.Class({extends:cc.Component,properties:{body:{default:null,type:cc.Node},Uarm:{default:null,type:cc.Node},Larm:{default:null,type:cc.Node},hand:{default:null,type:cc.Node},foot:{default:null,type:cc.Node},handDist:{default:null,type:cc.Node}},handMoveEnable:function(){var t=cc.find("Canvas");t.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.handBody=this.hand.getComponent(cc.RigidBody),this.touchPoints=[],this.force=cc.v2(0,0)},onTouchStart:function(t){this.touching=!0,this.touchStartPoint=cc.v2(t.touch.getLocation()),this.handDistStartPoint=this.handDist.position},onTouchMove:function(t){this.touchPoint=cc.v2(t.touch.getLocation()),this.handDistPoint=this.handDist.position,this.mouseDeltaMove=this.touchPoint.sub(this.touchStartPoint)},onTouchEnd:function(t){this.touchPoint=cc.v2(t.touch.getLocation()),this.hand.getComponent("handContact").holdCollider(),this.mouseDeltaMove=void 0},moveBodyLeft:function(){this.footBody.applyForceToCenter(cc.v2(-6e4,0))},moveBodyLRight:function(){this.footBody.applyForceToCenter(cc.v2(6e4,0))},onLoad:function(){this.handMoveEnable(),this.footBody=this.foot.getComponent(cc.RigidBody)},start:function(){},update:function(t){this.mouseDeltaMove&&(this.handDist.position=this.handDistStartPoint.add(this.mouseDeltaMove))}}),cc._RF.pop()},{}],contact:[function(t,o,e){"use strict";cc._RF.push(o,"b97d1udTaFMnaTU9RQC2nPu","contact");function n(t,o){return t.fraction>o.fraction?1:t.fraction<o.fraction?-1:0}function i(t,o,e){return cc.Intersection.pointLineDistance(t,o,e,!0)<1}cc.Class({extends:cc.Component,properties:{materialBrittle:.1},init:function(t){this.gameCtl=t},initCtx:function(t){this.ctx=t},onBeginContact:function(t,o,e){this.selfCollider=o;var n=t.getWorldManifold(),i=n.points,c=(n.normal,o.body.getLinearVelocityFromWorldPoint(n.points[0])),s=e.body.getLinearVelocityFromWorldPoint(n.points[0]).sub(c);this.ctx&&(this.ctx.circle(i[0].x,i[0].y,5),this.ctx.fill()),this.calCrash(i[0],s,o)},onEndContact:function(t,o,e){},onPreSolve:function(t,o,e){},onPostSolve:function(t,o,e){},calCrash:function(t,o,e){var n=t.add(o.mul(this.materialBrittle)),i=(t=t.sub(o.mul(.01)),cc.director.getPhysicsManager()),c=i.rayCast(t,n,cc.RayCastType.All),s=i.rayCast(n,t,cc.RayCastType.All);this.ctx.clear(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(n.x,n.y),this.ctx.stroke(),s.forEach(function(t){t.fraction=1-t.fraction});for(var l=c.concat(s),r=[],h=function(t){for(var o=!1,n=l[t],i=0;i<r.length;i++){var c=r[i];if(c[0]&&n.collider===c[0].collider){o=!0;var s=c.find(function(t){return t.point.sub(n.point).magSqr()<=5});s?c.splice(c.indexOf(s),1):c.push(n);break}}o||n.collider!==e||r.push([n])},a=0;a<l.length;a++)h(a);if(this.pairs=r,l.length>0)for(a=0;a<l.length;a++)this.ctx.circle(l[a].point.x,l[a].point.y,5),this.ctx.fill();for(var d=0;d<this.pairs.length;d++)if(this.pairs[d].length>0)for(var g=0;g<this.pairs[d].length;g++)this.ctx.circle(this.pairs[d][g].point.x,this.pairs[d][g].point.y,5),this.ctx.fill();this.createSplit(this.pairs)},createSplit:function(t){for(var o=0;o<t.length;o++){var e=t[o];if(!(e.length<2)){e=e.sort(n);for(var i=[],c=0;c<e.length-1;c+=2){var s=e[c],l=e[c+1];s&&l&&this.split(s.collider,s.point,l.point,i)}if(!(i.length<=0)){for(var r=e[0].collider,h=void 0,a=0;a<i.length;a++){for(var d=i[a],g=0;g<d.length;g++)"number"==typeof d[g]&&(d[g]=r.points[d[g]]);(!h||d.length>h.length)&&(h=d)}if(!(h.length<3)){r.points=h,r.apply();var u=r.body;this.judgeRemove(u);for(var p=0;p<i.length;p++){var f=i[p];if(!(f.length<3)&&f!=h){var y=new cc.Node;y.position=u.getWorldPosition(),y.rotation=u.getWorldRotation(),y.parent=cc.director.getScene(),(u=y.addComponent(cc.RigidBody)).enabledContactListener=!0,y.addComponent("contact").initCtx(this.ctx);var v=y.addComponent(cc.PhysicsPolygonCollider);v.points=f,v.apply()}}}}}}},judgeRemove:function(t){t.getMass()<.5&&t.node.destroy()},split:function(t,o,e,n){for(var c=t.body,s=t.points,l=[o=c.getLocalPoint(o),e=c.getLocalPoint(e)],r=[e,o],h=void 0,a=void 0,d=0;d<s.length;d++){var g=s[d],u=d===s.length-1?s[0]:s[d+1];if(void 0===h&&i(o,g,u)?h=d:void 0===a&&i(e,g,u)&&(a=d),void 0!==h&&void 0!==a)break}if(void 0!==h&&void 0!==a){var p=void 0,f=h,y=a;if(n.length>0)for(var v=0;v<n.length;v++){var m=n[v];if(f=m.indexOf(h),y=m.indexOf(a),-1!==f&&-1!==y){p=n.splice(v,1)[0];break}}p||(p=s.map(function(t,o){return o}));for(var C=f+1;C!==y+1;C++){C>=p.length&&(C=0);var b=p[C];(b="number"==typeof b?s[b]:b).sub(o).magSqr()<5||b.sub(e).magSqr()<5||r.push(p[C])}for(var J=y+1;J!==f+1;J++){J>=p.length&&(J=0);var U=p[J];(U="number"==typeof U?s[U]:U).sub(o).magSqr()<5||U.sub(e).magSqr()<5||l.push(p[J])}n.push(l),n.push(r)}},start:function(){}}),cc._RF.pop()},{}],drawPolygon:[function(t,o,e){"use strict";cc._RF.push(o,"ddc6ezYF69JVKgsZ318siQM","drawPolygon"),cc.Class({extends:cc.Component,onEnable:function(){this.debugDrawFlags=cc.director.getPhysicsManager().debugDrawFlags,cc.director.getPhysicsManager().debugDrawFlags=cc.PhysicsManager.DrawBits.e_jointBit|cc.PhysicsManager.DrawBits.e_shapeBit},onDisable:function(){cc.director.getPhysicsManager().debugDrawFlags=this.debugDrawFlags},properties:{},onLoad:function(){var t=cc.find("Canvas");t.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.ctx=this.getComponent(cc.Graphics),this.touchPoints=[]},onTouchStart:function(t){this.touching=!0,this.r1=this.r2=this.results=null,this.touchStartPoint=this.touchPoint=cc.v2(t.touch.getLocation())},onTouchMove:function(t){this.touchPoint=cc.v2(t.touch.getLocation())},onTouchEnd:function(t){this.touchPoint=cc.v2(t.touch.getLocation());var o=this.touchPoint;this.checkPointDist(o)&&(this.ctx.circle(o.x,o.y,5),this.ctx.fill(),this.touchPoints.push(o))},checkPointDist:function(t){var o=!0,e=this.touchPoints.length;if(0==e)return o;for(var n=0;n<e;n++)if(this.touchPoints[n].sub(t).mag()<5)return o=!1;return o},createBody:function(){var t=this.touchPoints;if(this.checkIsPolygon()){var o=new cc.Node;o.parent=cc.director.getScene();var e=o.addComponent(cc.RigidBody);e.enabledContactListener=!0,o.addComponent("contact").initCtx(this.ctx);var n=o.addComponent(cc.PhysicsPolygonCollider);n.points=t,n.apply(),this.touchPoints=[],this.ctx.clear(),console.log("mass",e.getMass())}},checkIsPolygon:function(){var t=this.touchPoints,o=t.length;if(o<3)return this.touchPoints=[],this.ctx.clear(),!1;for(var e=0;e<o-3;e++)for(var n=e;n<o-3;n++){var i=t[e],c=t[e+1],s=t[n+2],l=t[n+3],r=cc.Intersection.lineLine(i,c,s,l);if(console.log("Intersection:",e,n,r),!0===r)return this.touchPoints=[],this.ctx.clear(),!1}return!0},start:function(){},update:function(t){}}),cc._RF.pop()},{}],gameControl:[function(t,o,e){"use strict";cc._RF.push(o,"4e19d/flHBOQrrey6j9KVvB","gameControl");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.canvas=cc.find("Canvas"),this.scene=cc.director.getScene(),this.timer=3},getChildBody:function(){for(var t=this.scene.children,o=[],e=t.length,n=0;n<e;n++){var i=t[n].getComponent(cc.RigidBody);t[n].getComponent("contact")&&o.push(i)}return o},judgeRemove:function(t){var o=t.getMass();o<.5&&(console.log("remove body",o),t.node.destroy())},start:function(){},update:function(t){if(this.timer-=t,this.timer<0){var o=this.getChildBody(),e=o.length;if(e>0)for(var n=0;n<e;n++)this.judgeRemove(o[n]);this.timer=1}}}),cc._RF.pop()},{}],handContact:[function(t,o,e){"use strict";cc._RF.push(o,"842f84yt8lABIV6vvHJMYFv","handContact"),cc.Class({extends:cc.Component,properties:{},holdCollider:function(){var t=this.contact,o=this.selfCollider,e=this.otherCollider;if(t){t.getWorldManifold().points;var n=this.node.addComponent(cc.WeldJoint);n.connectedBody=e.body,console.log("connectedBody",n.connectedBody);var i=o.body.getWorldPosition();console.log("holdPosition",i.x,i.y),i=e.body.getLocalPoint(i),console.log("holdPosition",i.x,i.y),n.connectedAnchor=i,n.frequency=.9}n&&(this.holdJoint=n)},releaseCollider:function(){this.holdJoint&&this.holdJoint.destroy()},onBeginContact:function(t,o,e){console.log("Hand contact"),this.contact=t,this.selfCollider=o,this.otherCollider=e},onEndContact:function(t,o,e){this.contact=void 0,this.selfCollider=void 0,this.otherCollider=void 0},onPreSolve:function(t,o,e){},onPostSolve:function(t,o,e){},start:function(){}}),cc._RF.pop()},{}],"physics-bound":[function(t,o,e){"use strict";cc._RF.push(o,"5679e08EchKg6T/uJg2HuSm","physics-bound"),cc.Class({extends:cc.Component,properties:{size:cc.size(0,0),mouseJoint:!1},onLoad:function(){var t=this.size.width||this.node.width,o=this.size.height||this.node.height,e=new cc.Node;e.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static,this._addBound(e,0,o/2,t,20),this._addBound(e,0,-o/2,t,20),this._addBound(e,-t/2,0,20,o),this._addBound(e,t/2,0,20,o),e.parent=this.node,cc.Camera.main.backgroundColor=cc.color().fromHEX("#2f69d2")},_addBound:function(t,o,e,n,i){var c=t.addComponent(cc.PhysicsBoxCollider);c.offset.x=o,c.offset.y=e,c.size.width=n,c.size.height=i}}),cc._RF.pop()},{}],"physics-settings":[function(t,o,e){"use strict";cc._RF.push(o,"7d924CjMP9GJaqdIeZjGzMe","physics-settings"),cc.game.on(cc.game.EVENT_ENGINE_INITED,function(){cc.director.getPhysicsManager().enabled=!0}),cc._RF.pop()},{}]},{},["atest-settings","cases-settings","char01","char02","contact","drawPolygon","gameControl","handContact","physics-bound","physics-settings"]);