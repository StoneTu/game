window.__require=function t(i,e,s){function o(a,c){if(!e[a]){if(!i[a]){var h=a.split("/");if(h=h[h.length-1],!i[h]){var l="function"==typeof __require&&__require;if(!c&&l)return l(h,!0);if(n)return n(h,!0);throw new Error("Cannot find module '"+a+"'")}}var r=e[a]={exports:{}};i[a][0].call(r.exports,function(t){return o(i[a][1][t]||t)},r,r.exports,t,i,e,s)}return e[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<s.length;a++)o(s[a]);return o}({charDragonBone:[function(t,i,e){"use strict";cc._RF.push(i,"2354c3EnD1Jca3qctG3x8Bd","charDragonBone"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.armatureDisplay=this.getComponent(dragonBones.ArmatureDisplay),this.isRunPlay=!1,this.isStop=!0,this.isJumpPlay=!1,this.isJumpEndPlay=!1,this.isClimbPlay=!1,this.isSquatPlay=!1,this.isSquating=!1,this.armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.animationEventHandler,this),this.armatureDisplay.timeScale=.5,this.currentPlay=void 0},animationEventHandler:function(t){t.type==dragonBones.EventObject.LOOP_COMPLETE&&(this.isRunPlay&&(this.isRunPlay=!1),this.isJumpPlay&&(this.isJumpPlay=!1,this.isStop=!0),this.isJumpEndPlay&&(this.isJumpEndPlay=!1),this.isClimbPlay&&(this.isClimbPlay=!1,this.armatureDisplay.timeScale=.5),this.isSquatPlay&&(this.isSquating=!0),this.isSquating&&(this.isSquatPlay=!1,this.isSquating=!1))},start:function(){},runPlay:function(){this.isStop&&!this.isJumoPlay?(this.isStop=!1,this.currentPlay=this.armatureDisplay.playAnimation("run_start",1)):this.isRunPlay||this.isJumoPlay||(this.isRunPlay=!0,this.currentPlay=this.armatureDisplay.playAnimation("run",1))},runStop:function(){this.isRunPlay||this.isStop||(this.isStop=!0,this.currentPlay=this.armatureDisplay.playAnimation("run_end",1))},jumpPlay:function(){this.isJumpPlay||(this.isJumpPlay=!0,this.currentPlay.stop(),this.currentPlay=this.armatureDisplay.playAnimation("jump",1))},jumpEnd:function(){this.isJumpEndPlay||(this.isJumpEndPlay=!0,this.isStop=!0,this.currentPlay=this.armatureDisplay.playAnimation("jump_end",1))},runJumpPlay:function(){this.isJumpPlay||(this.isJumpPlay=!0,this.currentPlay.stop(),this.currentPlay=this.armatureDisplay.playAnimation("run_jump",1))},climbPlay:function(){this.isClimbPlay||(this.isClimbPlay=!0,this.currentPlay.stop(),this.armatureDisplay.timeScale=.3,this.currentPlay=this.armatureDisplay.playAnimation("climb",1))},squatPlay:function(){this.isSquatPlay||(this.isSquatPlay=!0,this.isStop=!0,this.currentPlay.stop(),this.currentPlay=this.armatureDisplay.playAnimation("squat",1))},squatEnd:function(){this.isSquating||(this.isSquating=!0,this.isStop=!0,this.currentPlay.stop(),this.currentPlay=this.armatureDisplay.playAnimation("squat_end",1))}}),cc._RF.pop()},{}],contactBody:[function(t,i,e){"use strict";cc._RF.push(i,"68b9ewa3TNEDL7nIbq+z9fA","contactBody");cc.Class({extends:cc.Component,properties:{},init:function(t){this.playerControl=t},onBeginContact:function(t,i,e){if(t&&(this.contact=t),e)switch(this.otherCollider=e,e.node.group){case"floor":break;case"box":1===this.playerControl.playerMode?t.disabled=!0:2===this.playerControl.playerMode&&(t.disabled=!1)}},onEndContact:function(t,i,e){this.contact=void 0,this.selfCollider=void 0,this.otherCollider=void 0},onPreSolve:function(t,i,e){},onPostSolve:function(t,i,e){},start:function(){},update:function(t){}}),cc._RF.pop()},{}],contact:[function(t,i,e){"use strict";cc._RF.push(i,"cb1d1HLufhFYLM1HhItdd71","contact");cc.Class({extends:cc.Component,properties:{},init:function(t){this.playerControl=t},onBeginContact:function(t,i,e){if(t&&(this.contact=t),e)switch(this.otherCollider=e,e.node.group){case"floor":break;case"box":if(1===this.playerControl.playerMode)return void(t.disabled=!0);2===this.playerControl.playerMode&&(t.disabled=!1)}if(i){this.selfCollider=i;t.getWorldManifold().points;if(i.body.linearVelocity.y>0)return void(t.disabled=!0);switch(i.node.name){case"foot":this.resetJumpCount();break;case"hand":this.climbContact()}}},onEndContact:function(t,i,e){this.contact=void 0,this.selfCollider=void 0,this.otherCollider=void 0},onPreSolve:function(t,i,e){},onPostSolve:function(t,i,e){},resetJumpCount:function(){this.playerControl.jumpEnd()},climbContact:function(){this.contact&&this.playerControl.climbAction(this.otherCollider.node)},start:function(){},update:function(t){}}),cc._RF.pop()},{}],"physics-settings":[function(t,i,e){"use strict";cc._RF.push(i,"7d924CjMP9GJaqdIeZjGzMe","physics-settings"),cc.game.on(cc.game.EVENT_ENGINE_INITED,function(){var t=cc.director.getPhysicsManager();t.enabled=!0,t.debugDrawFlags=0}),cc._RF.pop()},{}],playerControl:[function(t,i,e){"use strict";cc._RF.push(i,"6fc86RgnPlPjLOL8x/OVTmI","playerControl");cc.macro.ENABLE_TILEDMAP_CULLING=!1,cc.Class({extends:cc.Component,properties:{camera:{default:null,type:cc.Node},body:{default:null,type:cc.Node},hand:{default:null,type:cc.Node},foot:{default:null,type:cc.Node}},setProperties:function(){this.maxSpeed=200,this.jumps=1,this.acceleration=200,this.jumpSpeed=200,this.drag=100},onLoad:function(){this.setProperties(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this._moveFlags=0,this.bodySpeed=cc.v2(0,0),this.playerMode=1,this.isEnableKey=!0,this._up=!1,this.isClimbPlayReset=!1,this.isSquatPlayed=!1,this.body=this.getComponent(cc.RigidBody),this.collider=this.getComponent(cc.PhysicsBoxCollider),this.handCollider=this.hand.getComponent(cc.PhysicsPolygonCollider),this.body.getComponent("contactBody").init(this),this.foot.getComponent("contact").init(this);var t=this.hand.getComponent("contact");this.hand.body=this.hand.getComponent(cc.RigidBody),this.hand.collider=this.hand.getComponent(cc.PhysicsPolygonCollider),t.init(this),this.DBControl=this.body.getComponent("charDragonBone"),this.tiledmap=cc.find("tiledmap_1").getComponent("tiledmap")},onKeyDown:function(t){if(this.isEnableKey)switch(t.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.left:this._downPressed||(this._moveFlags|=1);break;case cc.macro.KEY.d:case cc.macro.KEY.right:this._downPressed||(this._moveFlags|=2);break;case cc.macro.KEY.up:this._upPressed||this._downPressed||(this._up=!0,Math.abs(this.bodySpeed.y)<.15&&0===this.jumps&&(this.isClimb=!0,this.DBControl.climbPlay(),this.isClimbPlayReset=!0)),this._upPressed=!0;break;case cc.macro.KEY.down:this._downPressed||this._upPressed||this._moveFlags||(this._down=!0),this._downPressed=!0;break;case cc.macro.KEY.shift:1===this.playerMode?this.playerMode=2:2===this.playerMode&&(this.playerMode=1)}},onKeyUp:function(t){switch(t.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.left:this._moveFlags&=-2;break;case cc.macro.KEY.d:case cc.macro.KEY.right:this._moveFlags&=-3;break;case cc.macro.KEY.up:this._upPressed=!1;break;case cc.macro.KEY.down:this._downPressed=!1}this.tiledmap.checkAtEndTile(this.node.position)&&cc.director.loadScene("result")},jumpEnd:function(){this.jumps=1,this.hand.collider.sensor=!0,this.hand.collider.apply(),this.isClimb=!1,this.isClimbPlayReset||this.DBControl.jumpEnd(),this.climbTime=0,this.isClimbPlayReset=!1,this.enableKey()},climbAction:function(t){this.climbTime=1.8;this.body.linearVelocity;this.enableKey()},climbMove:function(t){var i=cc.v2(0,0);return this.isClimb&&this.climbTime>0&&(this.disableKey(),this.climbTime-=t,i.y+=1.8*this.acceleration*t,this.climbTime<0&&(1===this.node.scaleX?i.x=this.maxSpeed/5:i.x=-this.maxSpeed/5,this.isClimb=!1,this.enableKey())),i},disableKey:function(){this.isEnableKey=!1,this._moveFlags=0,this._upPressed=!1},enableKey:function(){this.isEnableKey=!0},changeColliderSize:function(t){var i=(t-this.collider.size.height)/2;this.collider.size.height=t,this.collider.offset.y+=i,this.collider.apply()},update:function(t){var i=this.body.linearVelocity;if(1===this._moveFlags)this.DBControl.runPlay(),this.node.scaleX>0&&(this.node.scaleX*=-1,this.handCollider.apply()),i.x-=this.acceleration*t,i.x<-this.maxSpeed&&(i.x=-this.maxSpeed);else if(2===this._moveFlags)this.DBControl.runPlay(),this.node.scaleX<0&&(this.node.scaleX*=-1,this.handCollider.apply()),i.x+=this.acceleration*t,i.x>this.maxSpeed&&(i.x=this.maxSpeed);else if(0!=i.x){this.DBControl.runStop();var e=this.drag*t;Math.abs(i.x)<=e?i.x=0:i.x-=i.x>0?e:-e}this.jumps>0&&this._up&&(2===this._moveFlags||1===this._moveFlags?(this.DBControl.runJumpPlay(),Math.abs(i.x)<this.maxSpeed/2&&(i.x=this.maxSpeed/2*this.node.scaleX)):this.DBControl.jumpPlay(),i.y=this.jumpSpeed,this.jumps--,this.hand.collider.sensor=!1,this.hand.collider.apply(),this.disableKey()),this._down&&!this.isSquatPlayed&&(this.DBControl.squatPlay(),this.isSquatPlayed=!0,this.changeColliderSize(30)),this.isSquatPlayed&&!this._downPressed&&(this.DBControl.squatEnd(),this.isSquatPlayed=!1,this.changeColliderSize(60));var s=this.climbMove(t);i.addSelf(s),this._up=!1,this._down=!1,this.body.linearVelocity=i,this.bodySpeed=i,this.camera.x=this.node.position.x+1100,this.camera.y=this.node.position.y+1400}}),cc._RF.pop()},{}],result:[function(t,i,e){"use strict";cc._RF.push(i,"0756fhHAIFMo5U4zfz9P5EX","result"),cc.Class({extends:cc.Component,properties:{},initTouch:function(){var t=cc.find("Canvas");t&&(t.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this))},endTouch:function(){var t=cc.find("Canvas");t&&(t.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this))},onTouchEnd:function(t){this.endTouch(),cc.director.loadScene("map")},onLoad:function(){this.initTouch()},start:function(){}}),cc._RF.pop()},{}],tiledmap:[function(t,i,e){"use strict";cc._RF.push(i,"d2029+9Qz1CD6bC1qpZK4Tq","tiledmap"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.player=this.node.getChildByName("player"),this.loadMap()},tryCatchFood:function(t){var i=this.foods.getTileGIDAt(t);i&&(this.tiledMap.getPropertiesForGID(i).isFood&&this.foods.removeTileAt(t))},loadMap:function(){this.orgPos=cc.v2(1600,1600),this.node.setPosition(this.orgPos),this.tiledMap=this.node.getComponent(cc.TiledMap);var t=this.tiledMap.getObjectGroup("object"),i=this.tiledMap.getObjectGroup("floorObj").getObjects();this.createTilemapCollider(i);var e=t.getObjects("startPoint"),s=e[Math.floor(Math.random()*e.length)],o=t.getObject("endPoint"),n=cc.v2(s.x,s.y),a=cc.v2(o.x,o.y);this.floor=this.tiledMap.getLayer("floor"),this.playerTile=this.startTile=this.getTilePos(n),this.endTile=this.getTilePos(a),this.updatePlayerPos()},getTilePos:function(t){var i=this.node.getContentSize(),e=this.tiledMap.getTileSize(),s=Math.floor(t.x/e.width),o=Math.floor((i.height-t.y)/e.height);return cc.v2(s,o)},updatePlayerPos:function(){var t=this.floor.getPositionAt(this.playerTile).sub(this.orgPos);this.player.setPosition(t)},checkAtEndTile:function(t){var i=this.floor.getPositionAt(this.endTile).sub(this.orgPos).sub(t).mag();return console.log("end dist :",i),i<30},createTilemapCollider:function(t){var i,e=this.orgPos.sub(cc.v2(0,0)),s=!0,o=!1,n=void 0;try{for(var a,c=t[Symbol.iterator]();!(s=(a=c.next()).done);s=!0){i=a.value;var h=new cc.Node;h.group="floor",h.parent=this.tiledMap.node,h.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static;var l=[];if(l=i.points){l=this.transferTiledmapPolygonPoints(l);var r=h.addComponent(cc.PhysicsPolygonCollider);r.points=l,h.setPosition(cc.v2(i.x,i.y).sub(e)),r.apply()}else if(i.width){var d=h.addComponent(cc.PhysicsBoxCollider);h.setPosition(cc.v2(i.x,i.y).sub(e).add(cc.v2(i.width/2,-i.height/2))),d.size.width=i.width,d.size.height=i.height,d.apply()}}}catch(t){o=!0,n=t}finally{try{!s&&c.return&&c.return()}finally{if(o)throw n}}},transferTiledmapPolygonPoints:function(t){var i,e=[],s=!0,o=!1,n=void 0;try{for(var a,c=t[Symbol.iterator]();!(s=(a=c.next()).done);s=!0)i=a.value,e.push(cc.v2(i.x,-i.y))}catch(t){o=!0,n=t}finally{try{!s&&c.return&&c.return()}finally{if(o)throw n}}return e}}),cc._RF.pop()},{}]},{},["charDragonBone","contact","contactBody","physics-settings","playerControl","result","tiledmap"]);