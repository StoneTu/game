window.__require=function t(i,o,e){function c(r,s){if(!o[r]){if(!i[r]){var a=r.split("/");if(a=a[a.length-1],!i[a]){var h="function"==typeof __require&&__require;if(!s&&h)return h(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+r+"'")}}var l=o[r]={exports:{}};i[r][0].call(l.exports,function(t){return c(i[r][1][t]||t)},l,l.exports,t,i,o,e)}return o[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<e.length;r++)c(e[r]);return c}({board1:[function(t,i,o){"use strict";cc._RF.push(i,"369043au/1Ch4L79wobM+po","board1");cc.Class({extends:cc.Component,properties:{restartBtn:{default:null,type:cc.Node}},onLoad:function(){this.pieces=[[cc.v2(0,0),cc.v2(0,1),cc.v2(1,0)],[cc.v2(0,0),cc.v2(0,1),cc.v2(0,2),cc.v2(1,0)],[cc.v2(0,0),cc.v2(0,1),cc.v2(1,0),cc.v2(1,1)],[cc.v2(0,0),cc.v2(0,1),cc.v2(1,0),cc.v2(1,-1),cc.v2(-1,1)],[cc.v2(0,0),cc.v2(0,-1),cc.v2(0,-2),cc.v2(1,0),cc.v2(2,0)],[cc.v2(0,0),cc.v2(0,-1),cc.v2(-1,0),cc.v2(1,0),cc.v2(2,0)],[cc.v2(0,0),cc.v2(-1,0),cc.v2(0,1),cc.v2(1,0),cc.v2(1,1)],[cc.v2(0,0),cc.v2(0,-1),cc.v2(0,1),cc.v2(0,2)],[cc.v2(0,0),cc.v2(0,-1),cc.v2(-1,-1),cc.v2(1,0),cc.v2(2,0)],[cc.v2(0,0),cc.v2(0,-1),cc.v2(0,1),cc.v2(1,0),cc.v2(-1,0)],[cc.v2(0,0),cc.v2(-1,0),cc.v2(-1,-1),cc.v2(1,0),cc.v2(1,-1)],[cc.v2(0,0),cc.v2(-1,0),cc.v2(-1,-1),cc.v2(1,0),cc.v2(2,0)]],this.piecesColor=[new cc.Color(255,100,155),new cc.Color(65,65,65),cc.Color.YELLOW,new cc.Color(255,100,0),new cc.Color(0,0,100),cc.Color.GREEN,cc.Color.BLUE,new cc.Color(0,100,0),cc.Color.MAGENTA,cc.Color.RED,cc.Color.GRAY,new cc.Color(255,90,200)],this.originPosition=cc.v2(0,250),this.graphic=this.node.addComponent(cc.Graphics),this.createEmptyBoard(),this.drawChessBoard(),this.createOutsideSlot(),this.createPieces(),this.onSelectNode=this.pieceNode[0],this.restartBtn.active=!1,this.restartBtn.zIndex=99},restartAction:function(){cc.director.loadScene("board1")},pieceCW:function(){this.onSelectNode.getComponent("piece1").turnBallNodeCW()},pieceCCW:function(){this.onSelectNode.getComponent("piece1").turnBallNodeCCW()},pieceFlip:function(){this.onSelectNode.getComponent("piece1").turnBallNodeFlip()},start:function(){},createPieces:function(){this.pieceNode=[];for(var t=0;t<this.pieces.length;t++){var i=new cc.Node("piece"),o=i.addComponent("piece1");o.init(this.pieces[t],this.piecesColor[t]),o.home=this,i.parent=cc.find("Canvas"),i.setPosition(this.outsideSlot[t].position),i.dragable=!0,i.zIndex=99,this.pieceNode.push(i)}},createEmptyBoard:function(){this.board=[];for(var t=10;t>0;t--){for(var i=[],o=0;o<t;o++){i.push(0)}this.board.push(i)}},drawChessBoard:function(){this.boardNode=[];for(var t=this.board.length,i=0;i<t;i++){for(var o=[],e=this.board[i].length,c=0;c<e;c++){var n=this.calPosition(this.originPosition,i,c),r=new cc.Node("boardSlot");r.parent=cc.find("Canvas"),r.setPosition(n),r.zIndex=0,r.withPiece=!1,o.push(r),this.drawSpot(n,new cc.Color(30,30,30))}this.boardNode.push(o)}},calPosition:function(t,i,o){var e=-1*Math.sqrt(2)*20,c=t.x+e*i*-1+e*o,n=t.y+e*i+e*o;return cc.v2(c,n)},drawSpot:function(t,i){this.graphic.fillColor=i,this.graphic.circle(t.x,t.y,20),this.graphic.stroke(),this.graphic.fill()},createOutsideSlot:function(){this.outsideSlot=[];for(var t=cc.v2(-320,-230),i=0;i<6;i++)for(var o=0;o<2;o++){var e=t.add(cc.v2(130*i,130*o)),c=new cc.Node("outsideSlot");c.parent=cc.find("Canvas"),c.setPosition(e),c.zIndex=1;var n=c.addComponent(cc.Graphics);n.moveTo(-65,65),n.lineTo(65,65),n.lineTo(65,-65),n.lineTo(-65,-65),n.close(),n.strokeColor=cc.Color.GRAY,n.stroke(),this.outsideSlot.push(c)}},checkWin:function(){for(var t=this.boardNode.length,i=0;i<t;i++)for(var o=this.boardNode[i].length,e=0;e<o;e++)if(!this.boardNode[i][e].withPiece)return!1;return this.restartBtn.active=!0,!0}}),cc._RF.pop()},{}],piece1:[function(t,i,o){"use strict";cc._RF.push(i,"cf112K/Qm1NHY4cHaMM2Q7D","piece1");cc.Class({extends:cc.Component,properties:{interactable:!0,dragable:!0,_inDrag:!1,turnable:!0,fatherNodePosition:cc.v2(0,-310)},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},onLoad:function(){this.onEnable()},init:function(t,i){this.ballNodes=[],this.pieceArray=t;for(var o=t.length,e=0;e<o;e++)this.createBallNode(t[e],i);this.node.width=100,this.node.height=100},createBallNode:function(t,i){var o=new cc.Node("ball");cc.loader.loadRes("white_ball",cc.SpriteFrame,function(t,i){o.addComponent(cc.Sprite).spriteFrame=i}),o.opacity=255,o.parent=this.node,o.color=i,o.scale=.22;var e=this.calPosition(cc.v2(0,0),t.x,t.y);o.setPosition(e),this.ballNodes.push(o)},turnBallNodeCCW:function(){if(this.turnable)for(var t=this.pieceArray.length,i=0;i<t;i++){this.pieceArray[i]=cc.v2(this.pieceArray[i].y,-this.pieceArray[i].x);var o=this.calPosition(cc.v2(0,0),this.pieceArray[i].x,this.pieceArray[i].y);this.ballNodes[i].setPosition(o)}},turnBallNodeCW:function(){if(this.turnable)for(var t=this.pieceArray.length,i=0;i<t;i++){this.pieceArray[i]=cc.v2(-this.pieceArray[i].y,this.pieceArray[i].x);var o=this.calPosition(cc.v2(0,0),this.pieceArray[i].x,this.pieceArray[i].y);this.ballNodes[i].setPosition(o)}},turnBallNodeFlip:function(){if(this.turnable)for(var t=this.pieceArray.length,i=0;i<t;i++){this.pieceArray[i]=cc.v2(-this.pieceArray[i].x,this.pieceArray[i].y);var o=this.calPosition(cc.v2(0,0),this.pieceArray[i].x,this.pieceArray[i].y);this.ballNodes[i].setPosition(o)}},calPosition:function(t,i,o){var e=-1*Math.sqrt(2)*20,c=t.x+e*i*-1+e*o,n=t.y+e*i+e*o;return cc.v2(c,n)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this.dragable&&(this.oringialPos=this.node.position,this._dragTesting=!0,this.node.opacity=155,this.home.onSelectNode=this.node),t.stopPropagation())},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy){if(this._dragTesting&&!this._inDrag){if(this.dragable){var i=t.getStartLocation(),o=t.getLocation();o.subSelf(i),o.magSqr()>20&&(this._inDrag=!0,this.turnable=!0,cc.log("[drag] start drag"))}}else if(this._inDrag){var e=t.getStartLocation(),c=t.getLocation();c.subSelf(e);var n=this.oringialPos.add(c);this.node.setPosition(n),this.checkCollision()}t.stopPropagation()}},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._dragTesting=!1,this._inDrag&&(cc.log("[drag] stop drag"),this.pieceDrop()),this.dropable&&cc.log("[drop]"),this._inDrag=!1,this.node.opacity=255,this.node.setPosition(this.oringialPos),this.home.checkWin(),t.stopPropagation())},_onTouchCancel:function(t){this.interactable&&this.enabledInHierarchy&&(this._inDrag&&cc.log("[drag] stop drag"),this._inDrag=!1,this.node.opacity=255,this.node.setPosition(this.oringialPos),t.stopPropagation())},clearCurrentBoard:function(){if(this.dropableBoard)for(var t=0;t<this.dropableBoard.length;t++)this.dropableBoard[t].withPiece=!1},checkCollision:function(){this.clearCurrentBoard(),this.dropableBoard=[],this.dropablePiece=[];for(var t=this.ballNodes.length,i=0;i<t;i++){var o=this.node.position.add(this.ballNodes[i].position),e=this.checkDropableBoard(o);e&&(this.dropableBoard.push(e),this.dropablePiece.push(this.ballNodes[i]))}},checkDropableBoard:function(t){for(var i=this.home.board,o=this.home.boardNode,e=i.length,c=0;c<e;c++)for(var n=i[c].length,r=0;r<n;r++){if(!o[c][r].withPiece)if(o[c][r].position.sub(t).mag()<=20)return o[c][r]}},pieceDrop:function(){var t=this.dropablePiece.length,i=this.ballNodes.length;if(console.log("dropPieceLength",t),console.log("ballNodesLength",i),t===i){this.oringialPos=this.dropableBoard[0].position,this.node.opacity=255,this.turnable=!1;for(var o=0;o<t;o++)this.dropableBoard[o].withPiece=!0}var e=this.checkDropInOutsideSlot();e&&(this.oringialPos=e.position,this.turnable=!0)},checkDropInOutsideSlot:function(){for(var t=this.home.outsideSlot,i=0;i<t.length;i++){if(this.node.position.sub(t[i].position).mag()<=80)return t[i]}},start:function(){}}),cc._RF.pop()},{}]},{},["board1","piece1"]);